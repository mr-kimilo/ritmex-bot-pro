# 日志系统使用指南

## 概述

项目已集成完整的日志系统，会自动记录所有控制台输出和交易活动到日志文件中。

## 功能特性

### 🔄 自动清理
- 每次应用重启前，自动清理 `log/` 目录中的旧日志文件
- 保持日志目录清洁，避免磁盘空间积累

### 📝 时间格式命名
- 日志文件命名格式：`YYYY-MM-DD_HH-MM-SS.log`
- 示例：`2025-09-27_08-55-36.log`
- 避免Windows文件名冒号问题

### 📊 双重输出
- **控制台输出**：所有信息同时显示在终端
- **文件输出**：同时保存到日志文件，包含详细时间戳

### 🎯 智能分类
- **[LOG]** - 普通日志信息
- **[INFO]** - 信息性消息 
- **[WARN]** - 警告消息
- **[ERROR]** - 错误消息

## 技术实现

### 核心组件

1. **Logger类** (`src/utils/logger.ts`)
   - 自动创建和管理日志文件
   - 重写console方法，实现双重输出
   - 优雅处理进程退出

2. **TradeLog集成** (`src/state/trade-log.ts`)
   - 交易引擎的所有日志自动输出到控制台
   - 通过Logger系统同步保存到文件

### 使用方法

#### 在代码中记录日志

```typescript
// 普通日志
console.log("交易信息");

// 信息日志
console.info("系统状态");

// 警告日志  
console.warn("风险提醒");

// 错误日志
console.error("异常情况");

// 对象日志（自动JSON格式化）
console.log("订单详情:", orderObject);
```

#### 交易引擎日志

```typescript
// 交易引擎中使用tradeLog.push()
tradeLog.push("info", "🎯 动态风险管理已启用");
tradeLog.push("order", "📈 多头开仓: BUY 0.001 BTCUSDT @ $45000.00");
tradeLog.push("error", "❌ 订单提交失败");
```

### 日志文件格式

```log
[2025-09-27T00:55:36.249Z] 
=== 日志开始 2025-09-27_08-55-36 ===

[2025-09-27T00:55:36.250Z] [LOG] 🚀 交易机器人启动
[2025-09-27T00:55:36.277Z] [INFO] 🎯 动态风险管理已启用
[2025-09-27T00:55:36.277Z] [LOG] 📈 多头开仓: BUY 0.001 BTCUSDT
[2025-09-27T00:55:37.279Z] [WARN] ⚠️ 价格下跌，当前亏损: -1.2%
[2025-09-27T00:55:37.778Z] [ERROR] ❌ 订单提交失败: 余额不足
```

## 文件管理

### 日志目录结构
```
log/
├── 2025-09-27_08-55-36.log  # 当前会话日志
└── (自动清理旧文件)
```

### 存储策略
- ✅ **保留当前会话**：只保存当前运行会话的日志
- ✅ **自动清理**：重启时清除所有旧日志文件
- ✅ **即时写入**：实时写入，不丢失重要信息

## 配置选项

日志系统会自动初始化，无需手动配置。关键特性：

- 📁 **日志目录**：`log/`（如不存在会自动创建）
- 🔄 **清理策略**：重启时清理所有旧文件
- ⚡ **性能优化**：异步写入，不阻塞主线程
- 🛡️ **异常处理**：进程退出时自动关闭文件句柄

## 最佳实践

### ✅ 推荐
- 使用标准console方法记录日志
- 为重要操作使用适当的日志级别
- 交易相关信息使用tradeLog.push()

### ❌ 避免
- 直接操作日志文件
- 手动管理日志清理
- 绕过console系统写入文件

## 故障排除

### 常见问题

1. **日志文件未创建**
   - 检查log目录权限
   - 确认Logger已正确初始化

2. **日志内容缺失**  
   - 确认使用console.* API而不是直接输出
   - 检查应用是否正常退出

3. **文件名包含非法字符**
   - 系统使用下划线和连字符，兼容Windows

### 调试模式

如需调试日志系统本身：

```typescript
import { logger } from "./src/utils/logger";
console.log("当前日志文件:", logger.getLogFile());
```

## 系统集成

日志系统已完全集成到应用启动流程：

1. **入口文件** (`index.ts`) - 初始化日志系统
2. **主应用** (`src/index.tsx`) - 显示日志文件路径  
3. **交易引擎** - 所有tradeLog输出到控制台
4. **优雅退出** - 确保所有日志正确写入文件

启动时会看到：
```
🚀 RITMEX交易机器人启动中...
📝 日志文件: log\2025-09-27_08-55-36.log
```

这表示日志系统已成功初始化并准备记录所有活动。
