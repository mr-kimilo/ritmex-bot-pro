# 贪婪止盈使用指南

## 🎯 快速开始

### 1. 启用贪婪止盈
在 `.env` 文件中设置：
```properties
ENABLE_GREEDY_TAKE_PROFIT=true
```

### 2. 运行交易机器人
```bash
npm run start
```

当利润达到1.5%时，系统会自动激活贪婪模式，寻找更好的退出机会。

## ⚙️ 配置参数详解

### 基础配置
```properties
# 是否启用贪婪止盈功能
ENABLE_GREEDY_TAKE_PROFIT=true

# 价格采样数组大小 (推荐: 5-15)
GREEDY_SAMPLE_SIZE=10

# 价格反转阈值 (推荐: 0.001-0.005, 即0.1%-0.5%)
GREEDY_REVERSAL_THRESHOLD=0.002

# 最大等待时间，毫秒 (推荐: 15000-60000, 即15-60秒)
GREEDY_MAX_WAIT_TIME_MS=30000

# 额外收益目标 (推荐: 0.003-0.01, 即0.3%-1.0%)
GREEDY_EXTRA_PROFIT_TARGET=0.005
```

### 参数调优建议

#### 保守策略 (稳健收益)
```properties
GREEDY_SAMPLE_SIZE=5              # 小数组，快速反应
GREEDY_REVERSAL_THRESHOLD=0.001   # 敏感反转检测
GREEDY_MAX_WAIT_TIME_MS=15000     # 较短等待时间
GREEDY_EXTRA_PROFIT_TARGET=0.003  # 较小额外目标
```

#### 积极策略 (追求高收益)
```properties
GREEDY_SAMPLE_SIZE=15             # 大数组，平滑趋势
GREEDY_REVERSAL_THRESHOLD=0.005   # 较高反转阈值
GREEDY_MAX_WAIT_TIME_MS=60000     # 较长等待时间
GREEDY_EXTRA_PROFIT_TARGET=0.01   # 较大额外目标
```

## 📊 监控日志

### 激活日志
```
🎯 贪婪止盈已激活: 基础止盈达到1.50%，开始等待更高收益
```

### 状态更新
系统会显示当前价格采样和分析状态。

### 止盈触发
```
💰 贪婪止盈-价格反转 (+0.60%): SELL @ $102.1000
💰 贪婪止盈-额外收益达成 (+0.80%): SELL @ $103.2000  
💰 贪婪止盈-超时平仓 (+0.45%): SELL @ $101.8000
```

## 🔍 常见问题

### Q: 贪婪模式何时激活？
A: 当交易利润达到基础止盈阈值（默认1.5%）时自动激活。

### Q: 如果价格一直上涨怎么办？
A: 系统有超时保护机制，最长等待30秒后强制止盈。

### Q: 会不会因为太贪心而错过止盈？
A: 不会。系统有多重保护：
- 价格反转检测
- 超时强制止盈
- 随时可以降级到标准止盈

### Q: 适用于哪些市场条件？
A: 适用于各种市场条件，系统会自动调整策略：
- 趋势市场：追求额外收益
- 震荡市场：及时反转检测
- 横盘市场：超时保护

### Q: 如何临时禁用？
A: 设置 `ENABLE_GREEDY_TAKE_PROFIT=false` 并重启机器人。

## 📈 最佳实践

### 1. 回测验证
建议在不同市场条件下回测参数设置，找到最适合的配置。

### 2. 分阶段启用
- 第一周：使用保守参数，观察表现
- 第二周：根据结果调整参数
- 第三周：优化到最佳配置

### 3. 监控关键指标
- 贪婪模式激活频率
- 平均额外收益
- 止盈触发原因分布

### 4. 风险控制
- 定期检查日志确保功能正常
- 监控整体盈亏比变化
- 必要时调整参数或暂时禁用

## 🛠️ 故障排除

### 贪婪模式未激活
1. 检查 `ENABLE_GREEDY_TAKE_PROFIT=true`
2. 确认利润已达到基础止盈阈值
3. 查看日志中的详细信息

### 频繁触发反转止盈
- 调大 `GREEDY_REVERSAL_THRESHOLD` 值
- 增加 `GREEDY_SAMPLE_SIZE` 以平滑趋势

### 很少获得额外收益
- 减小 `GREEDY_EXTRA_PROFIT_TARGET` 值
- 增加 `GREEDY_MAX_WAIT_TIME_MS` 等待时间

---

💡 **提示**: 贪婪止盈是一个高级功能，建议先在测试模式下运行几天，熟悉其行为模式后再用于实盘交易。
