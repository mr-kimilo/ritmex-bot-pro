# ðŸŽ¯ æŒ‚å•ä»·æ ¼æ ¹æœ¬æ€§ä¿®å¤ï¼šåŸºäºŽä¹°1å–1çš„ç²¾ç¡®å®šä»·

## é—®é¢˜è¯Šæ–­

### å‘çŽ°çš„æ ¹æœ¬é—®é¢˜ï¼š
**çŽ°è±¡**: ä»·æ ¼1.947ï¼ŒæŒ‚å•è¿˜åœ¨1.9ï¼Œåç¦»4.5%ï¼

**æ ¹æœ¬åŽŸå› **: 
1. **åˆ©æ¶¦é”å®šæ­¢æŸä»·æ ¼è®¡ç®—é”™è¯¯** - å®Œå…¨åŸºäºŽå…¥åœºä»·æ ¼ï¼Œæ— è§†å½“å‰å¸‚ä»·
2. **ç¼ºä¹ä¹°1å–1ä»·æ ¼å‚è€ƒ** - åªç”¨lastPriceï¼Œä¸å¤Ÿç²¾ç¡®
3. **ä¸¤å¥—æ­¢æŸé€»è¾‘æ··ä¹±** - å¸¸è§„æ­¢æŸvsåˆ©æ¶¦é”å®šæ­¢æŸ

### ä»£ç åˆ†æžï¼š

**é—®é¢˜ä»£ç ** (åˆ©æ¶¦é”å®šæ­¢æŸ):
```typescript
const profitLockStopPrice = direction === "long"
  ? position.entryPrice + this.getCurrentProfitLockOffset() / Math.abs(position.positionAmt)
  : position.entryPrice - this.getCurrentProfitLockOffset() / Math.abs(position.positionAmt)
```
â˜ï¸ **å®Œå…¨åŸºäºŽå…¥åœºä»·ï¼Œä¸Žå½“å‰å¸‚ä»·è„±èŠ‚ï¼**

## è§£å†³æ–¹æ¡ˆ

### 1. åŒé‡æ­¢æŸä»·æ ¼ä¼˜åŒ–

**å¸¸è§„æ­¢æŸä¼˜åŒ–**:
```typescript
const stopPrice = direction === "long" 
  ? Math.max(bid1Price - bid1Price * 0.006, åŽŸå§‹æ­¢æŸä»·)  // åŸºäºŽä¹°1ä»·
  : Math.min(ask1Price + ask1Price * 0.006, åŽŸå§‹æ­¢æŸä»·)  // åŸºäºŽå–1ä»·
```

**åˆ©æ¶¦é”å®šæ­¢æŸä¼˜åŒ–**:
```typescript
const optimizedProfitLockStopPrice = isInProfit ? (
  direction === "long"
    ? Math.max(bid1Price - bid1Price * 0.006, profitLockStopPrice) // åŸºäºŽä¹°1ä»·
    : Math.min(ask1Price + ask1Price * 0.006, profitLockStopPrice)  // åŸºäºŽå–1ä»·
) : profitLockStopPrice;
```

### 2. ä¹°1å–1ç²¾ç¡®å®šä»·æœºåˆ¶

**ä»·æ ¼æ•°æ®æºä¼˜å…ˆçº§**:
1. **ä¹°1ä»·æ ¼** (`depthSnapshot.bids[0][0]`) - åšå¤šæ­¢æŸå‚è€ƒ
2. **å–1ä»·æ ¼** (`depthSnapshot.asks[0][0]`) - åšç©ºæ­¢æŸå‚è€ƒ  
3. **lastPrice** - å¤‡ç”¨ä»·æ ¼æº

**æ™ºèƒ½åç§»è®¡ç®—**:
- åšå¤šæ­¢æŸï¼š`ä¹°1ä»· - ä¹°1ä»· Ã— 0.6%`
- åšç©ºæ­¢æŸï¼š`å–1ä»· + å–1ä»· Ã— 0.6%`

### 3. ç›ˆåˆ©çŠ¶æ€åˆ¤æ–­ä¿æŠ¤

```typescript
const isInProfit = (direction === "long" && currentMarketPrice > position.entryPrice) ||
                   (direction === "short" && currentMarketPrice < position.entryPrice);
```

**ä¿æŠ¤é€»è¾‘**:
- âœ… ç›ˆåˆ©çŠ¶æ€ï¼šä½¿ç”¨ä¼˜åŒ–åŽçš„è´´è¿‘å¸‚ä»·æ­¢æŸ
- âŒ äºæŸçŠ¶æ€ï¼šä¿æŒåŽŸå§‹ä¿æŠ¤æ€§æ­¢æŸ

## é¢„æœŸæ•ˆæžœ

### ä»·æ ¼åˆ†å¸ƒç¤ºä¾‹ (ASTERUSDTå½“å‰æƒ…å†µ):

**ä¿®å¤å‰**:
```
å½“å‰ä»·æ ¼: 1.947
ä¹°1: 1.9440
å–1: 1.9460
æ­¢æŸå•: 1.9000 âŒ (åç¦»ä¹°1 2.3%ï¼)
```

**ä¿®å¤åŽ**:
```  
å½“å‰ä»·æ ¼: 1.947
ä¹°1: 1.9440
å–1: 1.9460
æ­¢æŸå•: 1.9323 âœ… (ä¹°1ä»· - 0.6% = 1.9440 - 0.0117 = 1.9323)
```

### å…³é”®æ”¹è¿›ï¼š

1. **ç²¾ç¡®è´´è¿‘å¸‚ä»·**: åç¦»ä»Ž2.3%é™åˆ°0.6%
2. **åŠ¨æ€è·Ÿéšæ·±åº¦**: éšä¹°1å–1å®žæ—¶è°ƒæ•´  
3. **æ™ºèƒ½ç›ˆåˆ©ä¿æŠ¤**: åªåœ¨ç›ˆåˆ©æ—¶è´´è¿‘å¸‚ä»·
4. **åŒé‡ä»·æ ¼ä¿æŠ¤**: å¸¸è§„+åˆ©æ¶¦é”å®šéƒ½ä¼˜åŒ–

## ç›‘æŽ§æ—¥å¿—

ç³»ç»Ÿå°†è¾“å‡ºè¯¦ç»†çš„ä»·æ ¼è°ƒæ•´ä¿¡æ¯ï¼š

```
ðŸŽ¯ é«˜é¢‘ä¼˜åŒ–æ­¢æŸä»·æ ¼: 1.9000 â†’ 1.9323 (ä¹°1: 1.9440, å–1: 1.9460)
ðŸ”’ ä¼˜åŒ–åˆ©æ¶¦é”å®šæ­¢æŸ: 1.9050 â†’ 1.9323 (ä¹°1: 1.9440, å–1: 1.9460)
```

## é…ç½®å‚æ•°

### å…³é”®çŽ¯å¢ƒå˜é‡ï¼š
```env
MARKET_PRICE_OFFSET_PCT=0.006           # 0.6% å¸‚ä»·åç§»ï¼Œè´´è¿‘ä½†å®‰å…¨
ENABLE_DYNAMIC_RISK=true                # å¯ç”¨åŠ¨æ€é£Žé™©ç®¡ç†
```

---

**è¿™ä¸ªä¿®å¤è§£å†³äº†æŒ‚å•ä»·æ ¼åç¦»å¸‚ä»·çš„æ ¹æœ¬é—®é¢˜ï¼ŒçŽ°åœ¨æ‰€æœ‰æ­¢æŸå•éƒ½ä¼šåŸºäºŽå®žæ—¶çš„ä¹°1å–1ä»·æ ¼ç²¾ç¡®è®¾ç½®ï¼Œç¡®ä¿åœ¨ASTERUSDT 1.947ä»·æ ¼ä¸‹çš„æŒ‚å•ä¼šåˆç†è´´è¿‘1.943å·¦å³ï¼Œè€Œä¸æ˜¯åœç•™åœ¨1.900ï¼** ðŸš€

*ä¿®å¤æ—¶é—´: 2025å¹´9æœˆ26æ—¥*  
*ç‰ˆæœ¬: ä¹°1å–1ç²¾ç¡®å®šä»·v1.0*
